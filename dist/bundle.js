!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.SimpleGraphQuery=r():t.SimpleGraphQuery=r()}(this,()=>(()=>{"use strict";var t={d:(r,e)=>{for(var n in e)t.o(e,n)&&!t.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:e[n]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};t.r(r),t.d(r,{default:()=>u,runQuery:()=>n});var e=function(){function t(t,r){this.result=t,this.expression=r}return t.prototype.prettyPrint=function(){return JSON.stringify(this.result,null,2)},t.prototype.noResult=function(){return Array.isArray(this.result)?0===this.result.length:"object"==typeof this.result&&"error"in this.result},t.prototype.singleResult=function(){if(Array.isArray(this.result)&&1===this.result.length&&1===this.result[0].length)return this.result[0][0];throw new Error("Result is not a singleton")},t.prototype.selectedAtoms=function(){return Array.isArray(this.result)?this.result.filter(function(t){return 1===t.length}).map(function(t){return String(t[0])}):[]},t.prototype.selectedTwoples=function(){return Array.isArray(this.result)?this.result.filter(function(t){return 2===t.length}).map(function(t){return[String(t[0]),String(t[1])]}):[]},t.prototype.selectedTuplesAll=function(){return Array.isArray(this.result)?this.result.map(function(t){return t.map(String)}):[]},t.prototype.isError=function(){return"object"==typeof this.result&&"error"in this.result},t.prototype.isSingleton=function(){return!!Array.isArray(this.result)&&1===this.result.length&&1===this.result[0].length},t.prototype.getExpression=function(){return this.expression},t.prototype.getRawResult=function(){return this.result},t}();function n(t,r){for(var e,n=function(t){var r=t.match(/\{\s*(.*?)\s*:\s*(\w+)\s*\|\s*(.*?)\s*\}/);if(!r)throw new Error("Parse error");r[0];var e=r[1],n=r[2],i=r[3];return{vars:e.split(",").map(function(t){return t.trim()}),type:n,condition:i}}(r),o=n.vars,s=n.type,u=n.condition,l=t.nodes.filter(function(t){return t.type===s}).map(function(t){return t.id}),a=[],p=0,f=l;p<f.length;p++)for(var c=f[p],h=0,y=l;h<y.length;h++){var g=y[h];i(u,((e={})[o[0]]=c,e[o[1]]=g,e),t)&&a.push([c,g])}return a}function i(t,r,e){return t.includes("=")?function(t,r,e){var n=t.split("=").map(function(t){return t.trim()}),i=n[0],s=n[1],u=o(i,r,e),l=o(s,r,e).values().next().value;return"string"==typeof l&&u.has(l)}(t,r,e):!!t.includes("in")&&function(t,r,e){var n=t.split("in").map(function(t){return t.trim()}),i=n[0],o=n[1],u=r[i],l=o.split("."),a=l[l.length-1].endsWith("*"),p=l[l.length-1].replace("*",""),f=a?s(u,p,e):function(t,r,e){return new Set(e.edges.filter(function(e){return e.from===t&&e.label===r}).map(function(t){return t.to}))}(u,p,e);return f.has(r[l[0]])}(t,r,e)}function o(t,r,e){if(t.includes(".")){var n=t.replace("*","").split("."),i=n[0],o=n[1],u=r[i];return"string"==typeof u?s(u,o,e):new Set}var l=r[t];return"string"==typeof l?new Set([l]):new Set}function s(t,r,e){for(var n=new Set,i=[t];i.length;){var o=i.pop();if(!n.has(o)){n.add(o);for(var s=0,u=e.edges;s<u.length;s++){var l=u[s];l.from!==o||l.label!==r||n.has(l.to)||i.push(l.to)}}}return n}const u=function(){function t(){this.context=null,this.graph=null}return t.prototype.initialize=function(t){this.context=t,t.processedData&&Array.isArray(t.processedData.nodes)&&Array.isArray(t.processedData.edges)?this.graph=t.processedData:this.graph=null},t.prototype.isReady=function(){return!!this.graph},t.prototype.evaluate=function(t,r){if(!this.graph)throw new Error("Evaluator not initialized");try{var i=n(this.graph,t);return new e(i,t)}catch(r){return new e({error:{message:r.message}},t)}},t}();return r})());